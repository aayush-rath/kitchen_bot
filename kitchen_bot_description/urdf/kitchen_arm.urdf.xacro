<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="kitchen_arm">
    <xacro:macro name="kitchen_arm">
        <material name="White">
        <color rgba="1.0 1.0 1.0 1.0"/>
        </material>

        <material name="Silver">
        <color rgba="0.75 0.75 0.75 1.0"/>
        </material>

        <xacro:property name="two_pi" value="6.283185307"/>
        <xacro:property name="arm_dh" value="false"/>
        <xacro:property name="visual_dir" value="visual"/>
        <xacro:property name="collision_dir" value="collision"/>
        <xacro:property name="add_mesh_suffix" value="false"/>
        <xacro:property name="collison_mesh_suffix" value="obj"/>
        <xacro:property name="mesh_path" value="$(find kitchen_bot_description)/meshes/kitchen_arm"/>
        <xacro:property name="link_inertial_params_file" value="$(find kitchen_bot_description)/config/kitchen_arm_inertial.yaml"/>
        <xacro:property name="inertial_params" value="${xacro.load_yaml(link_inertial_params_file)}"/>
        <xacro:property name="link_kinematics_params_file" value="$(find kitchen_bot_description)/config/kitchen_arm_kinematics.yaml"/>
        <xacro:property name="kinematics_config" value="${xacro.load_yaml(link_kinematics_params_file)}"/>
        <xacro:property name="kinematics_params" value="${kinematics_config['kinematics']}"/>
        <xacro:property name="link6_visual" value="../kitchen_arm/visual/link6"/>
        <xacro:property name="link6_collision" value="../kitchen_arm/collision/link6"/>

        <xacro:macro name="common_link_inertial" params="link_inertial_params origin_rpy:='0 0 0'">
            <inertial>
                <origin
                xyz="${link_inertial_params['origin']['x']} ${link_inertial_params['origin']['y']} ${link_inertial_params['origin']['z']}"
                rpy="${origin_rpy}" />
                <mass value="${link_inertial_params['mass']}" />
                <inertia
                ixx="${link_inertial_params['inertia']['ixx']}"
                ixy="${link_inertial_params['inertia']['ixy']}"
                ixz="${link_inertial_params['inertia']['ixz']}"
                iyy="${link_inertial_params['inertia']['iyy']}"
                iyz="${link_inertial_params['inertia']['iyz']}"
                izz="${link_inertial_params['inertia']['izz']}" />
            </inertial>
        </xacro:macro>

        <xacro:macro name="common_link_visual" params="mesh_filename add_mesh_suffix:=true material_name:='White' origin_xyz:='0 0 0' origin_rpy:='0 0 0' other_mesh_suffix:=''">
            <visual>
            <geometry>
                <mesh filename="${mesh_path}/${mesh_filename}.stl"/>
            </geometry>
            <origin xyz="${origin_xyz}" rpy="${origin_rpy}"/>
            <material name="${material_name}" />
            </visual>
        </xacro:macro>
    
        <xacro:macro name="common_link_collision" params="mesh_filename add_mesh_suffix:=true origin_xyz:='0 0 0' origin_rpy:='0 0 0' other_mesh_suffix:=''">
            <collision>
            <geometry>
                <mesh filename="${mesh_path}/${mesh_filename}.obj"/>
            </geometry>
            <origin xyz="${origin_xyz}" rpy="${origin_rpy}"/>
            </collision>
        </xacro:macro>

        <xacro:macro name="common_joint_origin" params="joint_kinematic_params">
            <origin xyz="${joint_kinematic_params['x']} ${joint_kinematic_params['y']} ${joint_kinematic_params['z']}" rpy="${joint_kinematic_params['roll']} ${joint_kinematic_params['pitch']} ${joint_kinematic_params['yaw']}" />
        </xacro:macro>


        <link name="link_base">
            <inertial>
            <origin xyz="0.0 0.0 0.09103" rpy="0 0 0" />
            <mass value="2.7" />
            <inertia
                ixx="0.00494875" ixy="-3.5E-06" ixz="1.25E-05"
                iyy="0.00494174" iyz="1.67E-06" izz="0.002219" />
            </inertial>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link_base"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link_base" 
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}" 
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <link name="link1">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link1']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link1"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link1"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint1" type="revolute">
            <parent link="link_base"/>
            <child link="link1"/>
            <origin xyz="0 0 0.267" rpy="0 0 0"/>
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint1']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-${two_pi}"
            upper="${two_pi}"
            effort="50.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <link name="link2">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link2']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link2"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link2"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint2" type="revolute">
            <parent link="link1"/>
            <child link="link2"/>
            <origin xyz="0 0 0" rpy="-1.5708 0 0" />
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint2']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-2.059"
            upper="2.0944"
            effort="50.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <link name="link3">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link3']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link3"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link3"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint3" type="revolute">
            <parent link="link2"/>
            <child link="link3"/>
            <origin xyz="0.0535 -0.2845 0" rpy="0 0 0"/>
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint3']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-3.927"
            upper="0.19198"
            effort="32.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <link name="link4">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link4']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link4"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link4"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint4" type="revolute">
            <parent link="link3"/>
            <child link="link4"/>
            <origin xyz="0.0775 0.3425 0" rpy="-1.5708 0 0"/>
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint4']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-${two_pi}"
            upper="${two_pi}"
            effort="32.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <link name="link5">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link5']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${visual_dir}/link5"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="White" />
            <xacro:common_link_collision 
            mesh_filename="${collision_dir}/link5"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint5" type="revolute">
            <parent link="link4"/>
            <child link="link5"/>
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint5']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-1.69297"
            upper="${pi}"
            effort="32.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <link name="link6">
            <xacro:common_link_inertial 
            link_inertial_params="${inertial_params['link6']}" 
            origin_rpy="0 0 0"/>
            <xacro:common_link_visual 
            mesh_filename="${link6_visual}"  
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0"
            material_name="Silver" />
            <xacro:common_link_collision 
            mesh_filename="${link6_collision}"  
            add_mesh_suffix="${add_mesh_suffix}" 
            other_mesh_suffix="${collison_mesh_suffix}"
            origin_xyz="0 0 0" 
            origin_rpy="0 0 0" />
        </link>

        <joint name="joint6" type="revolute">
            <parent link="link5"/>
            <child link="link6"/>
            <origin xyz="0.076 0.097 0" rpy="-1.5708 0 0"/>
            <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint6']}" />
            <axis xyz="0 0 1"/>
            <limit
            lower="-${two_pi}"
            upper="${two_pi}"
            effort="20.0"
            velocity="3.14"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>
<!-- 
        <ros2_control name="kitchen_arm_controller" type="system">
            <hardware>
            <plugin>kitchen_arm_control/MockSystem</plugin>
            </hardware>
            <joint name="joint1">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
            <joint name="joint2">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
            <joint name="joint3">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
            <joint name="joint4">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
            <joint name="joint5">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
            <joint name="joint6">
                <command_interface name="position"/>
                <state_interface name="position"/>
                <state_interface name="velocity"/>
            </joint>
        </ros2_control> -->
    </xacro:macro>
</robot>